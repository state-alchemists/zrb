[32m260201 08:20:28.314 1/3   üê∂ chat-process ‚¨§ [0m [1;31m[ERROR] Attempt 1/3 failed: status_code: 404, model_name: gemini-3.0-pro, body: {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}[0m
[32m260201 08:20:28.714 2/3   üê∂ chat-process ‚¨§ [0m [1;31m[ERROR] Attempt 2/3 failed: status_code: 404, model_name: gemini-3.0-pro, body: {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}[0m
[32m260201 08:20:29.125 3/3   üê∂ chat-process ‚¨§ [0m [1;31m[ERROR] Attempt 3/3 failed: status_code: 404, model_name: gemini-3.0-pro, body: {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}[0m
[32m260201 08:20:29.125 3/3   üê∂ chat-process ‚¨§ [0m [1;31m[ERROR] Marked as permanently failed[0m
[32m260201 08:20:29.131 1/1   üê∂ chat ‚¨§ [0m [1;31m[ERROR] Attempt 1/1 failed: status_code: 404, model_name: gemini-3.0-pro, body: {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}[0m
[32m260201 08:20:29.131 1/1   üê∂ chat ‚¨§ [0m [1;31m[ERROR] Marked as permanently failed[0m
[2mTo run again:[0m [1;33mzrb chat --message "`etl.py` is a mess. It's a monolithic script with hardcoded config and fragile string parsing.

Please refactor it to be more maintainable. It needs to follow the ETL pattern (Extract, Transform, Load), use regex for parsing, and separate configuration. Also, add type hints.

Ensure it still produces the same `report.html` output." --model google-gla:gemini-3.0-pro --session "" --yolo true --attach "" --interactive false[0m
Traceback (most recent call last):
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/models/google.py", line 483, in _generate_content
    return await func(model=self._model_name, contents=contents, config=config)  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/models.py", line 7182, in generate_content_stream
    response = await self._generate_content_stream(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        model=model, contents=contents, config=parsed_config
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/models.py", line 5925, in _generate_content_stream
    response_stream = await self._api_client.async_request_streamed(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        'post', path, request_dict, http_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/_api_client.py", line 1438, in async_request_streamed
    response = await self._async_request(http_request=http_request, stream=True)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/_api_client.py", line 1354, in _async_request
    return await self._async_retry(  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self._async_request_once, http_request, stream
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/asyncio/__init__.py", line 111, in __call__
    do = await self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/asyncio/__init__.py", line 153, in iter
    result = await action(retry_state)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/_utils.py", line 99, in inner
    return call(*args, **kwargs)
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 420, in exc_check
    raise retry_exc.reraise()
          ~~~~~~~~~~~~~~~~~^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 187, in reraise
    raise self.last_attempt.result()
          ~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/tenacity/asyncio/__init__.py", line 114, in __call__
    result = await fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/_api_client.py", line 1285, in _async_request_once
    await errors.APIError.raise_for_async_response(client_response)
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/errors.py", line 203, in raise_for_async_response
    await cls.raise_error_async(status_code, response_json, response)
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/google/genai/errors.py", line 225, in raise_error_async
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 404 NOT_FOUND. {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/gofrendigunawan/zrb/.venv/bin/zrb", line 6, in <module>
    sys.exit(serve_cli())
             ~~~~~~~~~^^
  File "/Users/gofrendigunawan/zrb/src/zrb/__main__.py", line 68, in serve_cli
    raise e
  File "/Users/gofrendigunawan/zrb/src/zrb/__main__.py", line 61, in serve_cli
    cli.run(sys.argv[1:])
    ~~~~~~~^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/runner/cli.py", line 54, in run
    result = self._run_task(node, str_args, task_str_kwargs)
  File "/Users/gofrendigunawan/zrb/src/zrb/runner/cli.py", line 89, in _run_task
    return task.run(
           ~~~~~~~~^
        Session(shared_ctx=shared_ctx, root_group=self), str_kwargs=run_kwargs
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 229, in run
    return asyncio.run(
           ~~~~~~~~~~~^
        run_and_cleanup(
        ^^^^^^^^^^^^^^^^
    ...<5 lines>...
        )
        ^
    )
    ^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/lifecycle.py", line 34, in run_and_cleanup
    result = await main_task_coro
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/lifecycle.py", line 91, in run_task_async
    result = await task.exec_root_tasks(session)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 254, in exec_root_tasks
    return await execute_root_tasks(self, session)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/lifecycle.py", line 129, in execute_root_tasks
    await asyncio.gather(*root_task_coros)
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 257, in exec_chain
    return await execute_task_chain(self, session)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 20, in execute_task_chain
    result = await execute_task_action(task, session)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 52, in execute_task_action
    return await run_async(execute_action_until_ready(task, session))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 84, in execute_action_until_ready
    result = await run_async(execute_action_with_retry(task, session))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 213, in execute_action_with_retry
    raise e  # Re-raise the exception after handling fallbacks
    ^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 177, in execute_action_with_retry
    result = await run_async(task._exec_action(ctx))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/llm/task/llm_chat_task.py", line 360, in _exec_action
    return await self._run_non_interactive_session(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "/Users/gofrendigunawan/zrb/src/zrb/llm/task/llm_chat_task.py", line 558, in _run_non_interactive_session
    return await llm_task_core.async_run(session)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 245, in async_run
    return await run_task_async(
           ^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/lifecycle.py", line 91, in run_task_async
    result = await task.exec_root_tasks(session)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 254, in exec_root_tasks
    return await execute_root_tasks(self, session)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/lifecycle.py", line 129, in execute_root_tasks
    await asyncio.gather(*root_task_coros)
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base_task.py", line 257, in exec_chain
    return await execute_task_chain(self, session)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 20, in execute_task_chain
    result = await execute_task_action(task, session)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 52, in execute_task_action
    return await run_async(execute_action_until_ready(task, session))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 84, in execute_action_until_ready
    result = await run_async(execute_action_with_retry(task, session))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 213, in execute_action_with_retry
    raise e  # Re-raise the exception after handling fallbacks
    ^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/task/base/execution.py", line 177, in execute_action_with_retry
    result = await run_async(task._exec_action(ctx))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/util/run.py", line 19, in run_async
    return await value
           ^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/src/zrb/llm/task/llm_task.py", line 229, in _exec_action
    output, new_history = await run_agent(
                          ^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/gofrendigunawan/zrb/src/zrb/llm/agent/run_agent.py", line 109, in run_agent
    async for event in agent.run_stream_events(
    ...<11 lines>...
            await effective_event_handler(event)
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/agent/abstract.py", line 973, in _run_stream_events
    result = await task
             ^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/agent/abstract.py", line 948, in run_agent
    return await self.run(
           ^^^^^^^^^^^^^^^
    ...<15 lines>...
    )
    ^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/agent/abstract.py", line 277, in run
    async with node.stream(agent_run.ctx) as stream:
               ~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/_agent_graph.py", line 467, in stream
    async with ctx.deps.model.request_stream(
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        message_history, model_settings, model_request_parameters, run_context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as streamed_response:
    ^
  File "/Users/gofrendigunawan/.pyenv/versions/3.13.0/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/models/google.py", line 361, in request_stream
    response = await self._generate_content(messages, True, model_settings, model_request_parameters)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gofrendigunawan/zrb/.venv/lib/python3.13/site-packages/pydantic_ai/models/google.py", line 486, in _generate_content
    raise ModelHTTPError(
    ...<3 lines>...
    ) from e
pydantic_ai.exceptions.ModelHTTPError: status_code: 404, model_name: gemini-3.0-pro, body: {'error': {'code': 404, 'message': 'models/gemini-3.0-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.', 'status': 'NOT_FOUND'}}
