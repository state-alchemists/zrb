The `purchase` method in `inventory_system.py` incorrectly handled concurrent requests, leading to a race condition. By restructuring the code to ensure the stock is updated atomically, I have resolved the issue. The inventory system now correctly manages stock levels under concurrent loads. After applying the fix, I ran the script, and the final stock count was consistently accurate, confirming the fix.